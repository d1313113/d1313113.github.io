(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{311:function(a,s,n){a.exports=n.p+"assets/img/2019-11-18-docker01.df5d7915.png"},312:function(a,s,n){a.exports=n.p+"assets/img/2019-11-18-docker02.de5b54ec.png"},313:function(a,s,n){a.exports=n.p+"assets/img/2019-11-18-docker03.7a1a7fc2.png"},345:function(a,s,n){"use strict";n.r(s);var e=n(1),t=Object(e.a)({},(function(){var a=this,s=a.$createElement,e=a._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"docker-的一点小实践"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-的一点小实践","aria-hidden":"true"}},[a._v("#")]),a._v(" docker 的一点小实践")]),a._v(" "),e("h2",{attrs:{id:"安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装","aria-hidden":"true"}},[a._v("#")]),a._v(" 安装")]),a._v(" "),e("p",[e("code",[a._v("docker")]),a._v("的安装并不算繁琐,如果是本地安装的话可以选择使用"),e("code",[a._v("gui")]),a._v("界面来安装,至于服务器安装,在基于各个发行版上官网也有详细的介绍,就不做展开.")]),a._v(" "),e("p",[a._v("安装成功后跑起"),e("code",[a._v("hello world")]),a._v(" "),e("img",{attrs:{src:n(311),alt:"hello-world"}})]),a._v(" "),e("h2",{attrs:{id:"安装镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装镜像","aria-hidden":"true"}},[a._v("#")]),a._v(" 安装镜像")]),a._v(" "),e("p",[a._v("使用"),e("code",[a._v("docker pull packageName")]),a._v("即可从"),e("code",[a._v("docker hub")]),a._v("中拉取"),e("code",[a._v("docker")]),a._v("镜像到本地")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("docker pull nginx\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h2",{attrs:{id:"开启-nginx-服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#开启-nginx-服务","aria-hidden":"true"}},[a._v("#")]),a._v(" 开启 nginx 服务")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# -d 后台运行")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# --name my-nginx 给实例起名")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# -p 指定端口号,第一个是宿主机端口号,第二个是实例端口号")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# nginx 需要运行的镜像")]),a._v("\ndocker run -d --name my-nginx -p "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("8888")]),a._v(":80 nginx\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br")])]),e("p",[a._v("根据端口号访问,能成功访问到.\n"),e("img",{attrs:{src:n(312),alt:"nginx"}})]),a._v(" "),e("h3",{attrs:{id:"配置-nginx-配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置-nginx-配置","aria-hidden":"true"}},[a._v("#")]),a._v(" 配置 nginx 配置")]),a._v(" "),e("p",[a._v("这一小节主要讲配置"),e("code",[a._v("nginx")]),a._v(",在使用"),e("code",[a._v("docker")]),a._v("时,我们希望使用宿主机提供的"),e("code",[a._v("nginx")]),a._v("配置,而不是使用容器中的配置.因此会引出如下3个问题.")]),a._v(" "),e("ul",[e("li",[a._v("日志文件会放置到哪里")]),a._v(" "),e("li",[a._v("修改的配置文件存储在哪里")]),a._v(" "),e("li",[a._v("项目文件放置在哪里")])]),a._v(" "),e("p",[a._v("一般的解决方案,就是把文件放在宿主机中,然后挂载到容器中,修改配置文件只需要执行")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("docker "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" -it contain_name "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("来进入到容器中,随后执行")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("nginx -s reload\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("重新加载一次文件即可.")]),a._v(" "),e("blockquote",[e("p",[a._v("通过"),e("code",[a._v("docker hub")]),a._v("拉取的"),e("code",[a._v("nginx")]),a._v("镜像,相关的配置文件在容器中的位置分别在:\n日志文件: /var/log/nginx\n默认配置文件: /etc/nginx/conf.d/default.conf\n配置文件位置: /etc/nginx/\n项目位置: /usr/share/nginx/html")])]),a._v(" "),e("h4",{attrs:{id:"_1-日志文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-日志文件","aria-hidden":"true"}},[a._v("#")]),a._v(" 1.日志文件")]),a._v(" "),e("p",[e("code",[a._v("nginx")]),a._v("的日志文件处理相对比较简单,主要就是"),e("code",[a._v("access, error")]),a._v("日志,只需要挂载宿主目录到容器中的"),e("code",[a._v("nginx")]),a._v("日志所在文件即可.")]),a._v(" "),e("h4",{attrs:{id:"_2-配置文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置文件","aria-hidden":"true"}},[a._v("#")]),a._v(" 2. 配置文件")]),a._v(" "),e("p",[a._v("配置文件相对来说会麻烦一点,一般来说"),e("code",[a._v("nginx")]),a._v("只需要加载"),e("code",[a._v("nginx.conf")]),a._v("就可以了,在"),e("code",[a._v("docker")]),a._v("中,首先加载的是"),e("code",[a._v("nginx.conf")]),a._v(",然后在"),e("code",[a._v("nginx.conf")]),a._v("中有这么一行")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("include /etc/nginx/conf.d/*.conf;\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("就是加载"),e("code",[a._v("conf.d")]),a._v("目录下面的配置文件,所以对于配置文件只需要挂载到"),e("code",[a._v("conf.d")]),a._v("中即可覆盖.")]),a._v(" "),e("h4",{attrs:{id:"_3-项目文件的问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-项目文件的问题","aria-hidden":"true"}},[a._v("#")]),a._v(" 3.项目文件的问题")]),a._v(" "),e("p",[a._v("类似日志的操作,把宿主机目录挂载到容器即可.")]),a._v(" "),e("h4",{attrs:{id:"运行容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#运行容器","aria-hidden":"true"}},[a._v("#")]),a._v(" 运行容器")]),a._v(" "),e("ol",[e("li",[a._v("在宿主机创建好需要的文件夹")])]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" /cumelmell/nginx/log -p\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" /cumelmell/nginx/conf -p\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" /cumelmell/nginx/html -p\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br")])]),e("ol",{attrs:{start:"2"}},[e("li",[e("p",[a._v("运行容器")])]),a._v(" "),e("li",[e("p",[a._v("挂载日志目录")])]),a._v(" "),e("li",[e("p",[a._v("挂载配置目录")])]),a._v(" "),e("li",[e("p",[a._v("直接将配置文件挂载出来,不推荐")])]),a._v(" "),e("li",[e("p",[a._v("挂载项目目录")])])]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("docker run --name my-nginx -d -p "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("8888")]),a._v(":80"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  -v /cumelmell/nginx/log:/var/log/nginx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  -v /cumelmell/nginx/conf:/etc/nginx/conf.d"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  -v /cumelmell/nginx/nginx.conf:/etc/nginx/nginx/conf"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  -v /cumelmell/nginx/html:/usr/share/nginx/html\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br")])]),e("p",[e("img",{attrs:{src:n(313),alt:"nginx-config"}})]),a._v(" "),e("h4",{attrs:{id:"其他"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#其他","aria-hidden":"true"}},[a._v("#")]),a._v(" 其他:")]),a._v(" "),e("ol",[e("li",[a._v("在修改了宿主机的配置后:\n可以运行下面两句命令其中一种可以重新加载配置")])]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 1. 直接刷新配置")]),a._v("\ndocker "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" -it my-nginx nginx -s reload\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 2. 进去容器内部在执行命令")]),a._v("\ndocker "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("exec")]),a._v(" -it my-nginx "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br")])]),e("p",[a._v("查看容器信息")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("docker inspect contain_name\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("查看容器挂载情况")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("docker inspect contain_name "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" Mounts -A "),e("span",{pre:!0,attrs:{class:"token number"}},[a._v("20")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("重新运行已有容器")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("docker start contain_hash/contain_name\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("停止容器")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("docker stop contain_hash/contain_name\n\ndocker "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("kill")]),a._v(" contain_hash/contain_name\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br")])]),e("p",[a._v("删除容器")]),a._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[a._v("docker "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" contain_hash/contain_name\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])])])}),[],!1,null,null,null);s.default=t.exports}}]);